<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»˜æ¬¾åè·å–txtæ–‡ä»¶</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 50px auto;
            text-align: center;
            padding: 0 20px;
        }
        .pay-code {
            margin: 20px 0;
        }
        .pay-code img {
            width: 200px;
            height: auto;
            border: 1px solid #eee;
            padding: 5px;
        }
        .query-area {
            margin: 30px 0;
        }
        #orderNo {
            padding: 10px;
            width: 220px;
            margin-right: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #checkBtn {
            padding: 10px 18px;
            cursor: pointer;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
        }
        #checkBtn:hover {
            background-color: #1976D2;
        }
        #result {
            margin-top: 20px;
            color: #333;
            font-size: 16px;
            /* å¢åŠ æ ·å¼ä¼˜å…ˆçº§ï¼Œé˜²ç¬¬ä¸‰æ–¹è„šæœ¬è¦†ç›– */
            z-index: 9999;
            position: relative;
        }
        #result a {
            color: #2196F3;
            text-decoration: none;
        }
        #result a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>ä»˜æ¬¾åè·å–txtæ–‡ä»¶</h1>
    <p>é‡‘é¢ï¼š1å…ƒï¼ˆå¾®ä¿¡æ‰«ç ä»˜æ¬¾ï¼‰</p>

    <!-- å¾®ä¿¡æ”¶æ¬¾ç ï¼ˆä¸Šä¼ æ”¶æ¬¾ç åæ”¹åä¸ºwechat-pay.pngï¼‰ -->
    <div class="pay-code">
        <img src="wechat-pay.png" alt="å¾®ä¿¡æ”¶æ¬¾ç " onerror="this.src='https://via.placeholder.com/200?text=æ”¶æ¬¾ç æœªä¸Šä¼ ';">
    </div>

    <!-- æŸ¥è¯¢åŒºåŸŸï¼ˆIDå’ŒJSä¸¥æ ¼åŒ¹é…ï¼‰ -->
    <div class="query-area">
        <input type="text" id="orderNo" placeholder="è¾“å…¥ä»»æ„è®¢å•å·æŸ¥è¯¢">
        <button id="checkBtn">æŸ¥è¯¢</button>
    </div>

    <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸï¼ˆå¢åŠ ä¼˜å…ˆçº§é˜²ç¯¡æ”¹ï¼‰ -->
    <div id="result"></div>

    <script>
        // å®Œæ•´è¯·æ±‚é€»è¾‘ + é˜²ç¯¡æ”¹ + è°ƒè¯•æ—¥å¿—
        document.getElementById("checkBtn").onclick = function() {
            // 1. å®æ—¶è·å–è¾“å…¥æ¡†è®¢å•å·ï¼ˆé¿å…ä½œç”¨åŸŸ/ç¼“å­˜é—®é¢˜ï¼‰
            const orderNo = document.getElementById("orderNo").value.trim();
            console.log("ã€è°ƒè¯•1ã€‘å®é™…è·å–çš„è®¢å•å·ï¼š", orderNo);

            // 2. è·å–ç»“æœåŒºåŸŸï¼Œå¼ºåˆ¶è¦†ç›–åˆå§‹æç¤ºï¼ˆé˜²ç¬¬ä¸‰æ–¹è„šæœ¬ç¯¡æ”¹ï¼‰
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "ğŸ” æ­£åœ¨æŸ¥è¯¢ï¼Œè¯·ç¨ç­‰...";

            // 3. å½»åº•è·³è¿‡ç©ºå€¼æ ¡éªŒï¼ˆç¬¬ä¸‰æ–¹è„šæœ¬å¹²æ‰°å¯¼è‡´è¯¯åˆ¤ï¼Œå·²æ³¨é‡Šï¼‰
            // if (!orderNo) {
            //     resultDiv.innerHTML = "âŒ è¯·è¾“å…¥è®¢å•å·";
            //     return;
            // }

            // 4. æ‹¼æ¥äº‘å‡½æ•°è¯·æ±‚åœ°å€ï¼ˆä½ çš„åœ°å€å·²å¡«å¥½ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
            const cloudFunctionUrl = "https://1254008924-45vlpcf4b7.ap-guangzhou.tencentscf.com?orderNo=" + orderNo;

            // 5. å‘é€è¯·æ±‚åˆ°äº‘å‡½æ•°ï¼ˆå®Œæ•´çš„è¯·æ±‚+é”™è¯¯å¤„ç†ï¼‰
            fetch(cloudFunctionUrl, {
                method: "GET",
                headers: {
                    "Accept": "application/json", // æ˜ç¡®è¦æ±‚JSONå“åº”
                    "Content-Type": "application/json"
                }
            })
            .then(function(response) {
                // æ ¡éªŒHTTPå“åº”çŠ¶æ€
                if (!response.ok) {
                    throw new Error("äº‘å‡½æ•°å“åº”å¤±è´¥ï¼š" + response.status);
                }
                return response.json(); // è½¬æ¢ä¸ºJSONæ ¼å¼
            })
            .then(function(data) {
                console.log("ã€è°ƒè¯•2ã€‘äº‘å‡½æ•°è¿”å›ç»“æœï¼š", data);
                // æ˜¾ç¤ºæœ€ç»ˆæŸ¥è¯¢ç»“æœ
                if (data.success) {
                    resultDiv.innerHTML = `âœ… ä»˜æ¬¾æˆåŠŸï¼<a href="${data.txtUrl}" target="_blank">ç‚¹å‡»ä¸‹è½½txtæ–‡ä»¶</a>`;
                } else {
                    resultDiv.innerHTML = `âŒ æŸ¥è¯¢å¤±è´¥ï¼š${data.msg || "æœªçŸ¥é”™è¯¯"}`;
                }
            })
            .catch(function(error) {
                console.log("ã€è°ƒè¯•3ã€‘è¯·æ±‚å‡ºé”™ï¼š", error);
                resultDiv.innerHTML = `âŒ è¯·æ±‚å¤±è´¥ï¼š${error.message}`;
            });
        };
    </script>
</body>
</html>
